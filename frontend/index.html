<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#ef5350">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HN New">
    <meta name="description" content="Personal HackerNews story browser with content extraction">
    <title>HN New</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" href="/static/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/static/icon.svg">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="app-layout">
        <!-- Left Sidebar (was header) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>HN New</h1>
                <button id="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
                    <span class="theme-icon-light">&#9790;</span>
                    <span class="theme-icon-dark">&#9788;</span>
                </button>
            </div>

            <nav id="view-tabs">
                <button class="tab active" data-view="all">All</button>
                <button class="tab" data-view="readlater">Read Later</button>
                <button class="tab" data-view="settings">Settings</button>
            </nav>

            <div id="status-bar">
                <div id="story-count">0 stories</div>
                <div id="content-status">Content: --</div>
                <div id="filter-status">Showing all</div>
            </div>

            <div class="sidebar-shortcuts">
                <kbd>j</kbd>/<kbd>k</kbd> nav
                <kbd>o</kbd> open
                <kbd>e</kbd> expand
                <kbd>?</kbd> help
            </div>
        </aside>

        <!-- Main Content Area -->
        <main>
            <!-- Stories View -->
            <section id="view-all" class="view active">
                <div id="controls">
                    <label>
                        <input type="checkbox" id="show-dismissed"> Show dismissed
                    </label>
                    <label>
                        <input type="checkbox" id="show-blocked"> Show blocked
                    </label>
                    <label>
                        <input type="checkbox" id="sort-oldest" checked> Oldest first
                    </label>
                    <button id="btn-refresh" title="Fetch new stories (F)">Refresh</button>
                </div>
                <ul id="story-list"></ul>
            </section>

            <!-- Read Later View -->
            <section id="view-readlater" class="view">
                <ul id="readlater-list"></ul>
                <p id="readlater-empty" class="empty-msg">No stories saved for later</p>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="view">
                <div class="settings-grid">
                    <div class="settings-section">
                        <h3>Blocked Domains</h3>
                        <p class="hint">Stories from these domains are hidden</p>
                        <div class="tag-list" id="blocked-domains"></div>
                        <div class="add-form">
                            <input type="text" id="add-blocked-domain" placeholder="domain.com">
                            <button onclick="addBlockedDomain()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Blocked Words</h3>
                        <p class="hint">Stories with these words in title are hidden</p>
                        <div class="tag-list" id="blocked-words"></div>
                        <div class="add-form">
                            <input type="text" id="add-blocked-word" placeholder="word">
                            <button onclick="addBlockedWord()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Merit Words</h3>
                        <p class="hint">Boost stories containing these words</p>
                        <div class="tag-list" id="merit-words"></div>
                        <div class="add-form">
                            <input type="text" id="add-merit-word" placeholder="word">
                            <button onclick="addMeritWord()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Demerit Words</h3>
                        <p class="hint">Penalize stories containing these words</p>
                        <div class="tag-list" id="demerit-words"></div>
                        <div class="add-form">
                            <input type="text" id="add-demerit-word" placeholder="word">
                            <button onclick="addDemeritWord()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Merit Domains</h3>
                        <p class="hint">Boost stories from these domains</p>
                        <div class="tag-list" id="merit-domains"></div>
                        <div class="add-form">
                            <input type="text" id="add-merit-domain" placeholder="domain.com">
                            <button onclick="addMeritDomain()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Demerit Domains</h3>
                        <p class="hint">Penalize stories from these domains</p>
                        <div class="tag-list" id="demerit-domains"></div>
                        <div class="add-form">
                            <input type="text" id="add-demerit-domain" placeholder="domain.com">
                            <button onclick="addDemeritDomain()">Add</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section" style="margin-top: 20px;">
                    <h3>Cloudflare Browser Rendering Usage</h3>
                    <div id="usage-stats">Loading...</div>
                </div>

                <div class="settings-section" style="margin-top: 20px;">
                    <h3>Actions</h3>
                    <button onclick="clearDismissed()">Clear all dismissed stories</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Content Modal -->
    <div id="content-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <h2 id="modal-title"></h2>
            <div id="modal-meta"></div>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"></div>

    <!-- Keyboard shortcuts help -->
    <div id="shortcuts-help" class="hidden">
        <h4>Keyboard Shortcuts</h4>
        <ul>
            <li><kbd>j</kbd> / <kbd>k</kbd> - Up / Down</li>
            <li><kbd>o</kbd> - Open story link</li>
            <li><kbd>Enter</kbd> - Open HN comments</li>
            <li><kbd>e</kbd> - Expand/collapse content</li>
            <li><kbd>r</kbd> - Toggle read later</li>
            <li><kbd>d</kbd> - Dismiss story</li>
            <li><kbd>b</kbd> - Block domain</li>
            <li><kbd>f</kbd> - Fetch new stories</li>
            <li><kbd>1-3</kbd> - Switch views</li>
            <li><kbd>?</kbd> - Toggle this help</li>
        </ul>
    </div>

    <script src="/static/app.js"></script>
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/sw.js')
                .catch(err => console.log('SW registration failed:', err));
        }
    </script>
</body>
</html>
