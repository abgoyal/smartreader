<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#ef5350">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HN New">
    <meta name="description" content="Personal HackerNews story browser with content extraction">
    <title>HN New</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="icon" href="/static/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/static/icon.svg">
</head>
<body>
    <div class="app-layout">
        <!-- Left Sidebar (was header) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>HN New</h1>
                <button id="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
                    <span class="theme-icon-light">&#9790;</span>
                    <span class="theme-icon-dark">&#9788;</span>
                </button>
            </div>

            <nav id="view-tabs">
                <button class="tab active" data-view="all">All</button>
                <button class="tab" data-view="readlater">Read Later</button>
                <button class="tab" data-view="settings">Settings</button>
            </nav>

            <div id="status-bar">
                <div id="story-count">0 stories</div>
                <div id="content-status">Content: --</div>
                <div id="filter-status">Showing all</div>
            </div>

            <div id="sidebar-controls">
                <label><input type="checkbox" id="show-dismissed"> Dismissed</label>
                <label><input type="checkbox" id="show-blocked"> Blocked</label>
                <label><input type="checkbox" id="front-page-only"> Front page only</label>
                <label><input type="checkbox" id="sort-oldest" checked> Oldest first</label>
                <button id="btn-refresh" title="Fetch new stories (F)">Refresh</button>
            </div>

            <div id="sidebar-cf-stats">
                <div class="cf-stats-label">CF Today</div>
                <div id="cf-stats-value">--</div>
            </div>

            <div id="sidebar-activity-stats">
                <div class="activity-stats-label">Activity</div>
                <div id="activity-stats">--</div>
            </div>

            <div class="sidebar-shortcuts">
                <span class="shortcut-hint"><kbd>j</kbd>/<kbd>k</kbd> nav · <kbd>o</kbd> open · <kbd>?</kbd> help</span>
            </div>

            <div id="shortcuts-help" class="hidden">
                <h4>Keyboard Shortcuts</h4>
                <ul>
                    <li><kbd>j</kbd> / <kbd>k</kbd> - Down / Up</li>
                    <li><kbd>o</kbd> - Open story link</li>
                    <li><kbd>Enter</kbd> - Open HN comments</li>
                    <li><kbd>e</kbd> - Expand/collapse content</li>
                    <li><kbd>r</kbd> - Toggle read later</li>
                    <li><kbd>d</kbd> - Dismiss story</li>
                    <li><kbd>b</kbd> - Block domain</li>
                    <li><kbd>f</kbd> - Fetch new stories</li>
                    <li><kbd>1-3</kbd> - Switch views</li>
                    <li><kbd>?</kbd> - Toggle this help</li>
                </ul>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main>
            <!-- Stories View -->
            <section id="view-all" class="view active">
                <ul id="story-list"></ul>
            </section>

            <!-- Read Later View -->
            <section id="view-readlater" class="view">
                <ul id="readlater-list"></ul>
                <p id="readlater-empty" class="empty-msg">No stories saved for later</p>
            </section>

            <!-- Settings View -->
            <section id="view-settings" class="view">
                <div class="settings-grid">
                    <div class="settings-section">
                        <h3>Blocked Domains</h3>
                        <p class="hint">Stories from these domains are hidden</p>
                        <div class="tag-list" id="blocked-domains"></div>
                        <div class="add-form">
                            <input type="text" id="add-blocked-domain" placeholder="domain.com">
                            <button onclick="addBlockedDomain()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Blocked Words</h3>
                        <p class="hint">Stories with these words in title are hidden</p>
                        <div class="tag-list" id="blocked-words"></div>
                        <div class="add-form">
                            <input type="text" id="add-blocked-word" placeholder="word">
                            <button onclick="addBlockedWord()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Merit Words</h3>
                        <p class="hint">Boost stories containing these words</p>
                        <div class="tag-list" id="merit-words"></div>
                        <div class="add-form">
                            <input type="text" id="add-merit-word" placeholder="word">
                            <button onclick="addMeritWord()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Demerit Words</h3>
                        <p class="hint">Penalize stories containing these words</p>
                        <div class="tag-list" id="demerit-words"></div>
                        <div class="add-form">
                            <input type="text" id="add-demerit-word" placeholder="word">
                            <button onclick="addDemeritWord()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Merit Domains</h3>
                        <p class="hint">Boost stories from these domains</p>
                        <div class="tag-list" id="merit-domains"></div>
                        <div class="add-form">
                            <input type="text" id="add-merit-domain" placeholder="domain.com">
                            <button onclick="addMeritDomain()">Add</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>Demerit Domains</h3>
                        <p class="hint">Penalize stories from these domains</p>
                        <div class="tag-list" id="demerit-domains"></div>
                        <div class="add-form">
                            <input type="text" id="add-demerit-domain" placeholder="domain.com">
                            <button onclick="addDemeritDomain()">Add</button>
                        </div>
                    </div>
                </div>

                <div class="settings-section" style="margin-top: 20px;">
                    <h3>Cloudflare Browser Rendering Usage</h3>
                    <div id="usage-stats">Loading...</div>
                </div>

            </section>
        </main>
    </div>

    <!-- Mobile FAB Menu Button (hidden on desktop) -->
    <button class="fab-menu" onclick="toggleBottomSheet()">☰</button>

    <!-- Mobile Bottom Sheet (hidden on desktop) -->
    <div class="bottom-sheet-backdrop" onclick="toggleBottomSheet()"></div>
    <div class="bottom-sheet">
        <div class="sheet-handle" onclick="toggleBottomSheet()"></div>
        <div class="sheet-content">
            <div class="sheet-section">
                <h3>Views</h3>
                <nav class="sheet-tabs">
                    <button class="tab active" data-view="all" onclick="switchView('all'); toggleBottomSheet();">All</button>
                    <button class="tab" data-view="readlater" onclick="switchView('readlater'); toggleBottomSheet();">Read Later</button>
                    <button class="tab" data-view="settings" onclick="switchView('settings'); toggleBottomSheet();">Settings</button>
                </nav>
            </div>
            <div class="sheet-section">
                <h3>Filters</h3>
                <div class="sheet-filters">
                    <label><input type="checkbox" id="mobile-show-dismissed" onchange="syncFilter('show-dismissed', this.checked)"> Dismissed</label>
                    <label><input type="checkbox" id="mobile-show-blocked" onchange="syncFilter('show-blocked', this.checked)"> Blocked</label>
                    <label><input type="checkbox" id="mobile-front-page-only" onchange="syncFilter('front-page-only', this.checked)"> Front page only</label>
                    <label><input type="checkbox" id="mobile-sort-oldest" onchange="syncFilter('sort-oldest', this.checked)" checked> Oldest first</label>
                </div>
            </div>
            <div class="sheet-section">
                <h3>Status</h3>
                <div class="sheet-status">
                    <div id="mobile-story-count">0 stories</div>
                    <div id="mobile-content-status">Content: --</div>
                </div>
            </div>
            <div class="sheet-section">
                <h3>Activity</h3>
                <div id="mobile-activity-stats" class="sheet-status">--</div>
            </div>
            <div class="sheet-section">
                <button onclick="fetchNewStories(); toggleBottomSheet();" style="width: 100%; padding: 12px;">Refresh Stories</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast"></div>

    <script src="/static/app.js"></script>
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/sw.js')
                .catch(err => console.log('SW registration failed:', err));
        }
    </script>
</body>
</html>
